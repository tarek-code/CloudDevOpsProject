---
# IAM policy and role AWSLoadBalancerControllerRole are created by Terraform (see terraform/main.tf).
# This role only creates the Kubernetes ServiceAccount and applies it so the ALB controller can use IRSA.
- name: Create Kubernetes ServiceAccount manifest for ALB Controller
  ansible.builtin.template:
    src: serviceaccount.yaml.j2
    dest: /tmp/alb-serviceaccount.yaml
    mode: "0644"

- name: Apply ServiceAccount to cluster
  ansible.builtin.shell: kubectl apply -f /tmp/alb-serviceaccount.yaml
  register: sa_apply
  changed_when: true
